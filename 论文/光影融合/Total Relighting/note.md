# Total Relighting: 学习重新照明肖像以替换背景
* 光舞台设置：光场舞台配备了331个可编程的LED灯和58个RGB相机，以60Hz的频率录制视频，分辨率为1240万像素[Guo et al. 2019]。总共，我们生成了约700个OLAT序列

* 训练数据融合方法：[Debevec et al. 2000]

## 作者

ROHIT PANDEY, SERGIO ORTS ESCOLANO, CHLOE LEGENDRE, CHRISTIAN HÄNE, SOFIEN BOUAZIZ, CHRISTOPH RHEMANN, PAUL DEBEVEC, 和 SEAN FANELLO，Google Research。

## 摘要

本研究提出了一种新颖的系统，用于肖像重新照明和背景替换，能够保持高频边界细节，并准确合成主体在新照明下的外观，从而为任何所需场景产生逼真的合成图像。技术包括通过 alpha matting 估计前景、重新照明和合成。研究表明，这些阶段可以在不使用先验（例如已知背景或已知照明）的情况下，无需特殊的采集技术，仅使用单个 RGB 肖像图像和新的、目标 HDR 照明环境作为输入，通过顺序流水线解决。

## 引言

将人物合成到场景中使其看起来真的在那里是视觉效果中的一个基本技术，也在智能手机摄影和视频会议中有应用。常见的做法是在绿色或蓝色屏幕前录制演员，并使用色键技术来获取 alpha 遮罩，然后更换背景。但是，这并不能确保主题上的照明与新背景环境中的照明一致，这需要通过复杂的照明布置或复杂的 LED 照明再现系统来解决。本研究的目标是设计一个系统，允许自动化的肖像重新照明和背景替换。

## 相关工作

- **基于图像的重新照明**：利用光传输的线性，可以将重新照明计算为在不同基础照明条件下的图像的线性组合。
- **肖像重新照明**：近期的工作解决了消费摄影中的肖像重新照明问题。
- **Alpha Matting、前景估计和合成**：在深度学习的进步下，许多新的 matting 方法被提出，改进了传统基准测试的结果。

## 框架

系统包括三个顺序步骤：首先是 matting 模块估计给定 RGB 图像的 alpha 遮罩和前景。然后，估计的前景和目标 HDR 照明环境被提供给重新照明模块，该模块推断表面几何和 albedo，并使用每像素照明表示来显式模拟渲染外观的漫反射和镜面反射成分。最后，合成模块将重新照明的结果、alpha 遮罩和新背景组合在一起，产生一个新的背景下的重新照明肖像，其中肖像的照明条件与新背景匹配。

## 方法

- **Matting 模块**：使用深度卷积网络扩展了 Cai 等人的方法，以预测 alpha 遮罩和前景颜色。
- **重新照明模块**：从输入前景到几何图像，编码每个像素的表面法线，然后到近似漫反射 albedo 图像。引入了一种新颖的每像素照明表示或光图，编码了给定全景目标 HDR 照明环境和推断的表面几何的镜面反射和漫反射成分。
- **合成**：使用 matting 方程将重新照明的前景合成到新背景中。

## 数据获取和真实数据生成

为了使用监督学习训练我们的模型，我们需要许多在不同光照环境下拍摄的不同主体的成对人像，并且需要目标重光照图像的真实光照信息。我们还需要用于生成新场景中最终合成图像的估计前景和 alpha 蒙版组件，以及之前提到的所需中间组件，如每像素反照率和法线。
为了生成这些数据，我们在光照舞台中使用多个相机记录的不同人物的反射场进行重光照。 [Debevec et al. 2000].使用从光照舞台数据中提取的蒙版，通过深度学习模型将重光照图像合成到背景上。这个过程比 Wang 等人 [2020] 的方法生成更真实的训练数据，后者是在合成的面部摄影测量扫描渲染上训练的，并使用近似的 BRDF（双向反射分布函数）。因此，我们的重光照技术在再现复杂的光传输现象方面表现更好，例如皮肤和头发上的次表面散射和空间变化的镜面反射。为了训练模型，需要多个在不同照明环境中拍摄的不同主题的配对肖像，以及目标重新照明图像的真实照明。还需要用于生成新场景中最终合成的估计前景和 alpha 遮罩组件，以及所需的中间组件，如每个像素的 albedo 和法线。通过在 light stage 中记录不同人的反射场来生成这些数据
### 数据获取
参照LeGendre等人[2020]的方法，我们拍摄了70位不同个体的反射场（OLAT图像），每个人做出九种不同的面部表情，并穿戴不同的服装和配饰（帽子、围巾等）。选择这些被摄体时考虑了广泛的年龄和肤色范围，以支持模型的泛化能力。光场舞台配备了331个可编程的LED灯和58个RGB相机，以60Hz的频率录制视频，分辨率为1240万像素[Guo et al. 2019]。总共，我们生成了约700个OLAT序列，每个序列从多个相机视角拍摄。
其中10%的序列使用58个相机录制，覆盖了360°的所有可能视角，提供了从任意视角的训练样本，涵盖全身。剩余90%的数据我们使用6个正面视角的子集录制，旨在模拟日常人像摄影的构图。因此，我们为58个相机录制了约7,560个独特的序列，然后使用来自www.HDRIHaven.com [Zaal et al. 2020]的约200个HDR全景照明环境进行随机旋转重新照明和合成，生成了800万个训练样本。

# 光场舞台配备了：可编程的LED灯+RGB相机，生成OLAT序列
## 局限性

尽管重新照明模型在重新照明方面一致性地超越了以往的工作，但它也有局限性。例如，服装的 albedo 推断可能不准确，可能是由于训练集中服装的多样性不足。

## 结论

提出了一个完整的系统，用于执行肖像重新照明和背景替换，仅需要单个在野外捕获的 RGB 肖像和新的、目标 HDR 照明环境作为输入。通过引入一种新颖的、基于物理的、像素对齐的照明表示，用于训练重新照明模块，实验表明重新照明模型可以令人信服地渲染包括次表面散射和镜面反射在内的非 Lambertian 效果，超越了肖像重新照明的最新技术。
